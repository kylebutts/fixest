<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimates a fixest estimation from a fixest environment — est_env • fixest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimates a fixest estimation from a fixest environment — est_env"><meta name="description" content="This is a function advanced users which allows to estimate any fixest estimation from a
fixest environment obtained with only.env = TRUE in a fixest estimation."><meta property="og:description" content="This is a function advanced users which allows to estimate any fixest estimation from a
fixest environment obtained with only.env = TRUE in a fixest estimation."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fixest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.12.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_estimations.html">Multiple estimations</a></li>
    <li><a class="dropdown-item" href="../articles/standard_errors.html">On standard-errors</a></li>
    <li><a class="dropdown-item" href="../articles/collinearity.html">On collinearity</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Estimation tables</h6></li>
    <li><a class="dropdown-item" href="../articles/exporting_tables.html">Exporting estimation tables</a></li>
    <li><a class="dropdown-item" href="../articles/etable_new_features.html">`etable`: new features in `fixest` 0.10.2</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lrberge/fixest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimates a <code>fixest</code> estimation from a <code>fixest</code> environment</h1>
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/HEAD/R/estimation.R" class="external-link"><code>R/estimation.R</code></a></small>
      <div class="d-none name"><code>est_env.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is a function advanced users which allows to estimate any <code>fixest</code> estimation from a
<code>fixest</code> environment obtained with <code>only.env = TRUE</code> in a <code>fixest</code> estimation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">est_env</span><span class="op">(</span><span class="va">env</span>, <span class="va">y</span>, <span class="va">X</span>, <span class="va">weights</span>, <span class="va">endo</span>, <span class="va">inst</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-env">env<a class="anchor" aria-label="anchor" href="#arg-env"></a></dt>
<dd><p>An environment obtained from a <code>fixest</code> estimation with <code>only.env = TRUE</code>. This is
intended for advanced users so there is no error handling: any other kind of input will
fail with a poor error message.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A vector representing the dependent variable. Should be of the same length
as the number of observations in the initial estimation.</p></dd>


<dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A matrix representing the independent variables. Should be of the same dimension
as in the initial estimation.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>A vector of weights (i.e. with only positive values). Should be of
the same length as the number of observations in the initial estimation. If identical
to the scalar 1, this will mean that no weights will be used in the estimation.</p></dd>


<dt id="arg-endo">endo<a class="anchor" aria-label="anchor" href="#arg-endo"></a></dt>
<dd><p>A matrix representing the endogenous regressors in IV estimations. It should
be of the same dimension as the original endogenous regressors.</p></dd>


<dt id="arg-inst">inst<a class="anchor" aria-label="anchor" href="#arg-inst"></a></dt>
<dd><p>A matrix representing the instruments in IV estimations. It should be of
the same dimension as the original instruments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>It returns the results of a <code>fixest</code> estimation: the one that was summoned when
obtaining the environment.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function has been created for advanced users, mostly to avoid overheads
when making simulations with <code>fixest</code>.</p>
<p>How can it help you make simulations? First make a core estimation with <code>only.env = TRUE</code>,
and usually with <code>only.coef = TRUE</code> (to avoid having extra things that take time to compute).
Then loop while modifying the appropriate things directly in the environment. Beware that
if you make a mistake here (typically giving stuff of the wrong length),
then you can make the R session crash because there is no more error-handling!
Finally estimate with <code>est_env(env = core_env)</code> and store the results.</p>
<p>Instead of <code>est_env</code>, you could use directly <code>fixest</code> estimations too, like <code>feols</code>,
since they accept the <code>env</code> argument. The function <code>est_env</code> is only here to add a
bit of generality to avoid the trouble to the user to write conditions
(look at the source, it's just a one liner).</p>
<p>Objects of main interest in the environment are:</p><dl><dt>lhs</dt>
<dd><p>The left hand side, or dependent variable.</p></dd>

<dt>linear.mat</dt>
<dd><p>The matrix of the right-hand-side, or explanatory variables.</p></dd>

<dt>iv_lhs</dt>
<dd><p>The matrix of the endogenous variables in IV regressions.</p></dd>

<dt>iv.mat</dt>
<dd><p>The matrix of the instruments in IV regressions.</p></dd>

<dt>weights.value</dt>
<dd><p>The vector of weights.</p></dd>


</dl><p>I strongly discourage changing the dimension of any of these elements, or else crash can occur.
However, you can change their values at will (given the dimension stay the same).
The only exception is the weights, which tolerates changing its dimension: it can
be identical to the scalar <code>1</code> (meaning no weights), or to something of the length the
number of observations.</p>
<p>I also discourage changing anything in the fixed-effects (even their value)
since this will almost surely lead to a crash.</p>
<p>Note that this function is mostly useful when the overheads/estimation ratio is high.
This means that OLS will benefit the most from this function. For GLM/Max.Lik. estimations,
the ratio is small since the overheads is only a tiny portion of the total estimation time.
Hence this function will be less useful for these models.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Laurent Berge</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's make a short simulation</span></span></span>
<span class="r-in"><span><span class="co"># Inspired from Grant McDermott bboot function</span></span></span>
<span class="r-in"><span><span class="co"># See https://twitter.com/grant_mcdermott/status/1487528757418102787</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simple function that computes a Bayesian bootstrap</span></span></span>
<span class="r-in"><span><span class="va">bboot</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n_sim</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># We bootstrap on the weights</span></span></span>
<span class="r-in"><span>  <span class="co"># Works with fixed-effects/IVs</span></span></span>
<span class="r-in"><span>  <span class="co">#  and with any fixest function that accepts weights</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">core_env</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">x</span>, only.coef <span class="op">=</span> <span class="cn">TRUE</span>, only.env <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">n_obs</span> <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">nobs</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">res_all</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="va">n_sim</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sim</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co">## begin: NOT RUN</span></span></span>
<span class="r-in"><span>    <span class="co">## We could directly assign in the environment:</span></span></span>
<span class="r-in"><span>    <span class="co"># assign("weights.value", rexp(n_obs, rate = 1), core_env)</span></span></span>
<span class="r-in"><span>    <span class="co"># res_all[[i]] = est_env(env = core_env)</span></span></span>
<span class="r-in"><span>    <span class="co">##   end: NOT RUN</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co">## Instead we can use the argument weights, which does the same</span></span></span>
<span class="r-in"><span>    <span class="va">res_all</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">est_env</span><span class="op">(</span>env <span class="op">=</span> <span class="va">core_env</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n_obs</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">res_all</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">hp</span>, <span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">boot_res</span> <span class="op">=</span> <span class="fu">bboot</span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coef</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">boot_res</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">std_err</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_res</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Comparing the results with the main estimation</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coeftable.html">coeftable</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Estimate Std. Error   t value     Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 37.22727012 1.59878754 23.284689 2.565459e-20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> wt          -3.87783074 0.63273349 -6.128695 1.119647e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hp          -0.03177295 0.00902971 -3.518712 1.451229e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"type")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "IID"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coef</span>, <span class="va">std_err</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    coef     std_err</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 37.06416839 1.878346352</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> wt          -3.82426295 0.613391938</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hp          -0.03262888 0.006218552</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

