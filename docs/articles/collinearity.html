<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>On collinearity • fixest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="On collinearity">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fixest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.12.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_estimations.html">Multiple estimations</a></li>
    <li><a class="dropdown-item" href="../articles/standard_errors.html">On standard-errors</a></li>
    <li><a class="dropdown-item" href="../articles/collinearity.html">On collinearity</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Estimation tables</h6></li>
    <li><a class="dropdown-item" href="../articles/exporting_tables.html">Exporting estimation tables</a></li>
    <li><a class="dropdown-item" href="../articles/etable_new_features.html">`etable`: new features in `fixest` 0.10.2</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lrberge/fixest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>On collinearity</h1>
                        <h4 data-toc-skip class="author">Laurent
Bergé</h4>
            
            <h4 data-toc-skip class="date">2025-04-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/HEAD/vignettes/collinearity.Rmd" class="external-link"><code>vignettes/collinearity.Rmd</code></a></small>
      <div class="d-none name"><code>collinearity.Rmd</code></div>
    </div>

    
    
<p>Collinearity is the pebble that inevitably enters the shoe of any
applied econometrician in the course of their work. The good news is
that econometrics software take that pebble out of your shoe for you.
The bad news is that sometimes this pebble is informative and tells you
that something is wrong with the model you are estimating.</p>
<p>If you know what collinearity is, how software deal with it, and how
it affects your coefficients, you’re fine! If you’re not described by
the previous sentence, then two cases when you encounter collinearity.
Either you’re lucky, and nothing happens or just a few unimportant
coefficients become meaningless. Either you’re unlucky and… well, your
main results are wrong and your paper should be retracted.</p>
<p>Without further ado, let’s try to remove chance from the econometrics
process and try to understand what collinearity is and how to deal with
it.</p>
<div class="section level2">
<h2 id="what-collinearity-is">What collinearity is<a class="anchor" aria-label="anchor" href="#what-collinearity-is"></a>
</h2>
<div class="section level3">
<h3 id="this-documents-definitions">This document’s definitions<a class="anchor" aria-label="anchor" href="#this-documents-definitions"></a>
</h3>
<p><strong>Definitions.</strong> We are in the context of an OLS
estimation. We have one dependent variable represented by the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>-vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>,
and the explanatory variables represented by the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>×</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">N \times K</annotation></semantics></math>
matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>.
The term <em>variable</em> can be used interchangeably with the term
<em>column</em> (referring to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>).</p>
<p><strong>Collinearity.</strong> There is presence of collinearity if
at least one column of the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
is a linear combination of the other columns. Alternatively, using a
more sophisticated language, there is collinearity whenever the rank of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
is strictly lower than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>.</p>
<p><strong>Collinear set.</strong> The collinear set is the set of all
columns that are a linear combination of the other columns.</p>
<p><strong>Regular set.</strong> The regular set is the set of all
columns that are not a linear combination of the other columns.</p>
</div>
<div class="section level3">
<h3 id="why-collinearity-can-be-a-problem">Why collinearity can be a problem<a class="anchor" aria-label="anchor" href="#why-collinearity-can-be-a-problem"></a>
</h3>
<div class="section level4">
<h4 id="technical-reason">Technical reason<a class="anchor" aria-label="anchor" href="#technical-reason"></a>
</h4>
<p>The OLS estimator is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>′</mi></msup><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi>′</mi></msup><mi>y</mi></mrow><annotation encoding="application/x-tex"> \hat{\beta} = (X^\prime X)^{-1}X^\prime y </annotation></semantics></math></p>
<p>In the presence of collinearity the square matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>′</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">X^\prime X</annotation></semantics></math>
is not of full rank, and hence is not invertible. This is like dividing
by 0, you can’t because it does not make sense. Here you cannot invert,
so
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>β</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\beta}</annotation></semantics></math>
is not defined.</p>
</div>
<div class="section level4">
<h4 id="subsec_FWL">Substantial reason<a class="anchor" aria-label="anchor" href="#subsec_FWL"></a>
</h4>
<p>A good theorem to understand how OLS works is the Frisch-Waugh-Lovell
(FWL) theorem.</p>
<p>Assume your set of explanatory variables is split in two: the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>k</mi><mn>1</mn></msub><annotation encoding="application/x-tex">k_1</annotation></semantics></math>
columns and the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>k</mi><mn>2</mn></msub><annotation encoding="application/x-tex">k_2</annotation></semantics></math>
columns (we have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><msub><mi>k</mi><mn>1</mn></msub><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">K = k_1 + k_2</annotation></semantics></math>).
Note that you can split the variables in any way you want. The model you
want to estimate is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>X</mi><mi>β</mi><mo>+</mo><mi>Z</mi><mi>γ</mi><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex"> y = X\beta + Z\gamma + \epsilon </annotation></semantics></math></p>
<p>Define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>y</mi><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>i</mi><mi>d</mi></mrow></msup><annotation encoding="application/x-tex">y^{resid}</annotation></semantics></math>
as the residual of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>X</mi><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>i</mi><mi>d</mi></mrow></msup><annotation encoding="application/x-tex">X^{resid}</annotation></semantics></math>
as the matrix where each column is the residual of each column of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>.
Consider the following estimation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>y</mi><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>i</mi><mi>d</mi></mrow></msup><mo>=</mo><msup><mi>X</mi><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>i</mi><mi>d</mi></mrow></msup><mi>θ</mi><mo>+</mo><msup><mi>ϵ</mi><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>i</mi><mi>d</mi></mrow></msup></mrow><annotation encoding="application/x-tex"> y^{resid} = X^{resid}\theta + \epsilon^{resid} </annotation></semantics></math></p>
<p>Then the theorem states that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo>=</mo><mover><mi>θ</mi><mo accent="true">̂</mo></mover></mrow><annotation encoding="application/x-tex">\hat\beta = \hat\theta</annotation></semantics></math>
and that the residuals of the two regressions are the same. You can find
an illustration below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Illustration of the FWL theorem's magic</span></span>
<span></span>
<span><span class="co"># We use the `iris` data set</span></span>
<span><span class="va">base</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x"</span>, <span class="st">"z1"</span>, <span class="st">"z2"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/">fixest</a></span><span class="op">)</span></span>
<span><span class="co"># The main estimation, we're only interested in `x`'s coefficient</span></span>
<span><span class="va">est</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z1</span> <span class="op">+</span> <span class="va">z2</span>, <span class="va">base</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We estimate both `y` and `x` on the other explanatory variables</span></span>
<span><span class="co">#  and get the matrix of residuals</span></span>
<span><span class="va">resids</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span><span class="op">)</span> <span class="op">~</span> <span class="va">z1</span> <span class="op">+</span> <span class="va">z2</span>, <span class="va">base</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># We estimate y's residuals on x's residuals</span></span>
<span><span class="va">est_fwl</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols.fit</a></span><span class="op">(</span><span class="va">resids</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">resids</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We compare the estimates: they are identical</span></span>
<span><span class="co"># The standards errors are also the same, modulo a constant factor</span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">est_fwl</span>, order <span class="op">=</span> <span class="st">"x|resid"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                 est            est_fwl</span></span>
<span><span class="co">#&gt; Dependent Var.:                   y         resids[,1]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; x                0.6508*** (0.0667)</span></span>
<span><span class="co">#&gt; resids[,2]                          0.6508*** (0.0660)</span></span>
<span><span class="co">#&gt; Constant          1.856*** (0.2508)</span></span>
<span><span class="co">#&gt; z1               0.7091*** (0.0567)</span></span>
<span><span class="co">#&gt; z2              -0.5565*** (0.1275)</span></span>
<span><span class="co">#&gt; _______________ ___________________ __________________</span></span>
<span><span class="co">#&gt; S.E. type                       IID                IID</span></span>
<span><span class="co">#&gt; Observations                    150                150</span></span>
<span><span class="co">#&gt; R2                          0.85861            0.39104</span></span>
<span><span class="co">#&gt; Adj. R2                     0.85571            0.39104</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Now let us use the theorem to understand collinearity. Take one
variable from the collinear set as the focal variable. By the definition
of collinearity, the residual of this variable on all other variables is
a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>-vector
of 0s. Indeed, since it is a linear combination of the other variables
in the collinear set, it can be perfectly explained and there is no
residual.</p>
<p>Using the FWL theorem, this means that the coefficient of this
variable in the main regression is the same as the coefficient of the
regression of the residual of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
on a constant equal to 0! This makes no sense, right. <strong>And this
is true for any variable in the collinear set!</strong></p>
<p>But what does that mean for <em>variables in the regular set?</em>
For any such variable, the residual on all other variables contains
variation, and hence the coefficient is well defined.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="when-is-collinearity-a-problem">When is collinearity a problem?<a class="anchor" aria-label="anchor" href="#when-is-collinearity-a-problem"></a>
</h2>
<p>Assume you have two sets of variables: focal variables for which you
want to <em>interpret</em> the coefficients, and control variables for
which the coefficients are not interpreted. These sets are represented
by the matrices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
respectively with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>k</mi><mn>1</mn></msub><annotation encoding="application/x-tex">k_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>k</mi><mn>2</mn></msub><annotation encoding="application/x-tex">k_2</annotation></semantics></math>
columns.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>X</mi><mi>β</mi><mo>+</mo><mi>Z</mi><mi>γ</mi><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex"> y = X\beta + Z\gamma + \epsilon </annotation></semantics></math></p>
<p>Now assume there is presence of collinearity and the model cannot be
directly estimated. There are two cases.</p>
<p><strong>1) The collinear set contains only control
variables.</strong> In this case collinearity is not an issue since it
affects only variables that are not interpreted. The fix is easy: drop
iteratively variables from the collinear set until there is no remaining
collinearity (reconstruct the collinear set at each step).</p>
<p>Note, importantly, that it is not because it affects only control
variables that collinearity is fine. You should always be wary: when
there is collinearity in practice when it shouldn’t in theory, this is
often the sign of coding mistakes (either the raw data is wrong or the
processing is flawed). Allow collinearity only when it makes sense in
theory (we’ll cover examples later <a href="#subsec_removal_good">when
collinearity is fine in theory</a>).</p>
<p><strong>2) The collinear set contains at least one focal
variable.</strong> <em>Now we have a problem.</em> Here collinearity can
have two origins: i) the model is misspecified, or ii) the focal
variables have been wrongly coded. If you are sure that the model is
well specified, then check the data and fix how the variables are
constructed. Now let’s cover model misspecification.</p>
<div class="section level3">
<h3 id="the-model-is-misspecified">The model is misspecified<a class="anchor" aria-label="anchor" href="#the-model-is-misspecified"></a>
</h3>
<p>Err… <em>the model is misspecified</em>, what does that mean? This
means that you are trying to estimate stuff that don’t make sense! It’s
like accepting the result of the following syllogism:</p>
<p>Let’s add
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>=</mo><mn>1</mn><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 = 1 - 1</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1 + 1</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mn>1</mn><mo>=</mo><mn>1</mn><mo>+</mo><mn>1</mn><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> 1 + 1 = 1 + 1 + (1 - 1) </annotation></semantics></math>
then let’s substract
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math>
on both sides:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⇔</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \Leftrightarrow (1 - 1) + (1 - 1) = (1 - 1)  </annotation></semantics></math>
and finally let’s divide by the same number on both sides:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⇔</mo><mn>1</mn><mo>+</mo><mn>1</mn><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> \Leftrightarrow 1 + 1 = 1  </annotation></semantics></math></p>
<p>The above equations look right but they’re wrong (notice the last
one). Misspecification in an econometric model is the same: <strong>it
(often) can be estimated, it looks right, but it’s wrong!</strong></p>
<p>The problem with a misspecified model is that <em>there is no
technical solution</em>, you have something wrong in the model and you
need to fix it – <em>theoretically</em>. To illustrate this, let us give
examples, some obvious, others less so.</p>
<div class="section level4">
<h4 id="subsec_gender_gap">Example 1: Gender gap in publications<a class="anchor" aria-label="anchor" href="#subsec_gender_gap"></a>
</h4>
<p>Let’s take the following context: you study the publication process
in science and want to quantify the gender gap in terms of publications.
You are also interested in the effect of age on publications. You have a
panel where scientists are indexed with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and years are indexed with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The dependent variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
is the number of publications, the focal explanatory variables are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><msub><mi>n</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">woman_{it}</annotation></semantics></math>
taking the value 1 if the person is a woman and 0 otherwise, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>g</mi><msub><mi>e</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">age_{it}</annotation></semantics></math>
is equal to the age of scientist
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
Finally you want to control for time invariant characteristics specific
to each scientist, and year specific factors common to all scientists.
That means: you include scientist and year fixed-effects.</p>
<p>You end up with the following specification:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>α</mi><mi>i</mi></msub><mo>+</mo><msub><mi>β</mi><mi>t</mi></msub><mo>+</mo><mi>γ</mi><mo>×</mo><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><msub><mi>n</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>+</mo><mi>θ</mi><mo>×</mo><mi>a</mi><mi>g</mi><msub><mi>e</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>ϵ</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex"> y_{it} = \alpha_i + \beta_t + \gamma \times woman_{it} + \theta \times age_{it} + \epsilon_{it} </annotation></semantics></math></p>
<p>The above model is utterly misspecified. Given that the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><msub><mi>n</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">woman_{it}</annotation></semantics></math>
is time invariant (we’ll allow variation and introduce another problem
later), it can be fully explained by the scientist fixed-effects. Hence
if you want absolutely to control for scientist fixed-effects: <em>you
cannot estimate the gender gap</em>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>γ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat\gamma</annotation></semantics></math>.
You <strong>absolutely can’t</strong>, live with it. You really need to
be aware of that, especially that <strong>econometrics software can give
you estimates for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>γ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat\gamma</annotation></semantics></math>!!!!</strong>
Ouch! The behavior of econometrics software is <a href="#sec_software">detailed later</a>.</p>
<p>Is that all? Are we done with misspecification? Well, although the
variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">age</annotation></semantics></math>
varies across time and scientists, it <em>is</em> in the collinear set.
We can decompose this variable as follows:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>g</mi><msub><mi>e</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>=</mo><mi>y</mi><mi>e</mi><mi>a</mi><msub><mi>r</mi><mi>t</mi></msub><mo>−</mo><mi>b</mi><mi>i</mi><mi>r</mi><mi>t</mi><mi>h</mi><mi>_</mi><mi>y</mi><mi>e</mi><mi>a</mi><msub><mi>r</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">age_{it} = year_{t} - birth\_year_{i}</annotation></semantics></math>.
Now we can see that this variable is a linear combination of a
scientist-invariant variable
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mi>e</mi><mi>a</mi><msub><mi>r</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">year_{t}</annotation></semantics></math>)
and a time-invariant variable
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>i</mi><mi>r</mi><mi>t</mi><mi>h</mi><mi>_</mi><mi>y</mi><mi>e</mi><mi>a</mi><msub><mi>r</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">birth\_year_{i}</annotation></semantics></math>).
This means that the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>g</mi><msub><mi>e</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">age_{it}</annotation></semantics></math>
can be fully explained by the scientist and time fixed-effects. Hence
you cannot estimate the effect of age in the presence of these
fixed-effects.</p>
<p><strong>Any solution?</strong> No. You need to change your model. In
this case, the easy solution is to drop the scientist fixed-effects and
accept the criticisms that may arise from not controlling for important
time invariant confounders. To reformulate, if any of your focal
variables is in a collinear set, you need to make non trivial changes to
your model specification.</p>
</div>
<div class="section level4">
<h4 id="example-2-sneaky-misspecification">Example 2: Sneaky misspecification<a class="anchor" aria-label="anchor" href="#example-2-sneaky-misspecification"></a>
</h4>
<p>We use the same context as above: the gender gap in publications. We
introduce the following differences. First the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">woman</annotation></semantics></math>
varies: some scientist can change from man to woman and vice versa.
Second, we use the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><msub><mi>d</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">harassed_{it}</annotation></semantics></math>
which is equal to 1 if scientist
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
reports being harrassed in year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
and 0 otherwise. This variable contains missing values – this is
important.</p>
<p>The model we estimate is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>α</mi><mi>i</mi></msub><mo>+</mo><msub><mi>β</mi><mi>t</mi></msub><mo>+</mo><mi>γ</mi><mo>×</mo><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><msub><mi>n</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>+</mo><mi>θ</mi><mo>×</mo><mi>h</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><msub><mi>d</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>ϵ</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex"> y_{it} = \alpha_i + \beta_t + \gamma \times woman_{it} + \theta \times harassed_{it} + \epsilon_{it} </annotation></semantics></math></p>
<p>This time the model is not misspecified since both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><msub><mi>n</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">woman_{it}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><msub><mi>d</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">harassed_{it}</annotation></semantics></math>
present variations that cannot be explained by scientist and time
fixed-effects alone (although the identification of the gender gap will
hinge only on the scientists reporting a variation in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><msub><mi>n</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">woman_{it}</annotation></semantics></math>).</p>
<p><strong>Sneaky misspecification.</strong> One problem arises if the
variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">harassed</annotation></semantics></math>
contains missing values and if, after removing observation with missing
values, there is no more within-scientist variation in the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><msub><mi>n</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">woman_{it}</annotation></semantics></math>.
In that case, the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">woman</annotation></semantics></math>
ends up in the collinear set when the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">harassed</annotation></semantics></math>
is included in the model. This is not a misspecified model <em>per
se</em>, but purely a data problem: the data does not support the model
specification.</p>
<p>In this specific case, one can apply variable imputation to end up
with more non-missing values for the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">harassed</annotation></semantics></math>
and be able to estimate the model. Or simply not use the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>a</mi><mi>r</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">harassed</annotation></semantics></math>
at all.</p>
<p>The bottom line is that, even if the model is well specified,
modifications of the sample, due to data availability for example, can
lead <em>in fine</em> to model misspecification. As mentionned before,
the problem is that econmetrics software can provide results even when
the model is misspecified, so one really needs to be aware of the
problem.</p>
<p>Now let us review how econometrics software deal with
collinearity.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="sec_software">Econometrics software and collinearity<a class="anchor" aria-label="anchor" href="#sec_software"></a>
</h2>
<p>Most econometrics software, be it in R, Stata, Python, etc,
automatically remove collinear variables to perform the estimation.</p>
<p><strong>Importantly, all software routines assume that the user
provides a well specified model.</strong> In other words, using the
terminology defined above, they assume that the focal variables <em>are
not</em> in the collinear set. It is the user’s responsibility to ensure
that. If this condition is respected, automatic removal of collinear
variables is a feature and not a bug.</p>
<p>In this section we first detail how most software remove collinear
variables and how they differ in doing so. We detail why automatic
removal is a feature. We end with a description of the pitfalls of
automatic removal.</p>
<div class="section level3">
<h3 id="detecting-collinearity-automatic-variable-removal-algorithms">Detecting collinearity: Automatic variable removal algorithms<a class="anchor" aria-label="anchor" href="#detecting-collinearity-automatic-variable-removal-algorithms"></a>
</h3>
<p>In general the process of collinearity fixing by variable removal is
as follows:</p>
<ul>
<li>for each explanatory variable, from left to right, <em>following the
order of the variables given by the user</em> (this is important):
<ul>
<li>check wether the current variable is positive to a collinearity test
with the variables previously done:
<ul>
<li>if collinear: remove it</li>
<li>else: continue</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>It is important to stress that we are not talking about
<em>mathematical collinearity</em> but only about <em>numerical
collinearity</em> which are two different beasts. Indeed, the results of
collinearity detection and fixing depend on the rountines’ algorithms.
This means that two different routines can lead to different results due
to their diverging algorithms – although this should be the excteption
rather than the rule.</p>
<p>Let us give two examples. In <code>R</code>, the function
<code>lm</code> uses a QR decomposition of the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
to solve the OLS problem. Linear dependencies (collinearity) are
resolved during the QR decomposition. Differently from <code>lm</code>,
the function <code>feols</code> from <code>fixest</code> resolves
collinearity during a Cholesky decompostion of the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>′</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">X^\prime X</annotation></semantics></math>.
While there are major advantages in terms of speed to use this method,
it is known to be inferior to the QR method for collinearity detection
because using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>′</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">X^\prime X</annotation></semantics></math>
instead of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
reduces numeric precision. In the vast majority of cases however, the
two methods are equivalent and provide similar results.</p>
</div>
<div class="section level3">
<h3 id="collinearity-is-a-numerical-problem">Collinearity is a numerical problem<a class="anchor" aria-label="anchor" href="#collinearity-is-a-numerical-problem"></a>
</h3>
<p>To nail the fact that collinearity fixing in econometrics sowftare is
a numerical problem, we give the following example. Consider the OLS
estimation of this simple model:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>α</mi><mo>+</mo><mi>β</mi><mi>x</mi><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex"> y = \alpha + \beta x + \epsilon </annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
is a vector equal to 1 for half of the observations and 0 for the
others. We generate the data with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha = 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\beta = 1</annotation></semantics></math>.
You know from your econometrics courses that the estimated coefficients
are invariant to translations as long as there is a constant in the
model. Let us check that out!</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We generate the data</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">1e6</span></span>
<span><span class="va">n_half</span> <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n_half</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we estimate y on x for various translations of x</span></span>
<span><span class="va">all_trans</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span> <span class="op">**</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_results</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">all_trans</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">trans</span> <span class="op">=</span> <span class="va">all_trans</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">all_results</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">trans</span><span class="op">)</span>, <span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># we display the results</span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">all_results</span><span class="op">)</span></span>
<span><span class="co">#&gt;                            model 1            model 2            model 3</span></span>
<span><span class="co">#&gt; Dependent Var.:                  y                  y                  y      </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Constant           0.0013 (0.0014) -9.974*** (0.0210) -99.75*** (0.2009)      </span></span>
<span><span class="co">#&gt; I(x+0)          0.9975*** (0.0020)</span></span>
<span><span class="co">#&gt; I(x+10)                            0.9975*** (0.0020)</span></span>
<span><span class="co">#&gt; I(x+100)                                              0.9975*** (0.0020)      </span></span>
<span><span class="co">#&gt; I(x+1000)</span></span>
<span><span class="co">#&gt; I(x+10000)</span></span>
<span><span class="co">#&gt; I(x+1e+05)</span></span>
<span><span class="co">#&gt; _______________ __________________ __________________ __________________      </span></span>
<span><span class="co">#&gt; S.E. type                      IID                IID                IID      </span></span>
<span><span class="co">#&gt; Observations             1,000,000          1,000,000          1,000,000      </span></span>
<span><span class="co">#&gt; R2                         0.19936            0.19936            0.19936      </span></span>
<span><span class="co">#&gt; Adj. R2                    0.19936            0.19936            0.19936      </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                            model 4             model 5              model 6   </span></span>
<span><span class="co">#&gt; Dependent Var.:                  y                   y                    y   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Constant         -997.5*** (2.000) -9,974.9*** (19.99) -99,749.2*** (199.9)   </span></span>
<span><span class="co">#&gt; I(x+0)</span></span>
<span><span class="co">#&gt; I(x+10)</span></span>
<span><span class="co">#&gt; I(x+100)</span></span>
<span><span class="co">#&gt; I(x+1000)       0.9975*** (0.0020)</span></span>
<span><span class="co">#&gt; I(x+10000)                          0.9975*** (0.0020)</span></span>
<span><span class="co">#&gt; I(x+1e+05)                                               0.9975*** (0.0020)   </span></span>
<span><span class="co">#&gt; _______________ __________________ ___________________ ____________________   </span></span>
<span><span class="co">#&gt; S.E. type                      IID                 IID                  IID   </span></span>
<span><span class="co">#&gt; Observations             1,000,000           1,000,000            1,000,000   </span></span>
<span><span class="co">#&gt; R2                         0.19936             0.19936              0.19936   </span></span>
<span><span class="co">#&gt; Adj. R2                    0.19936             0.19936              0.19936   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>As we can see, the prediction is true: translations do not change the
estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>β</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat\beta</annotation></semantics></math>.
But is that always true? What happens if we apply a bigger
translation?</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we add 1,000,000 to x</span></span>
<span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1e6</span><span class="op">)</span>, <span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; The variable 'I(x + 1e+06)' has been removed because of collinearity (see $collin.var).</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,000,000</span></span>
<span><span class="co">#&gt; Standard-errors: IID</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 0.500031   0.001117 447.653 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ... 1 variable was removed because of collinearity (I(x + 1e+06))</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 1.11701</span></span></code></pre></div>
<p>Ooopsie, our variable is now removed! This happens with the message:
“The variable […] removed because of collinearity”. What happened? The
algorithm could not invert
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>X</mi><mi>′</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">X^\prime X</annotation></semantics></math>
so removed the variable to be able to carry on. This is purely a
numerical problem: remember that we store numbers with 64 bits, leading
to at most 15 digits precision (so don’t be suprised of the result of
<code>1 + 1e16 == 1e16</code>). If the numbers were stored with 128bits
precision, there would be no rounding error and no variable removal.</p>
<p>Now let’s see <code>lm</code>’s algorithm.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1e6</span><span class="op">)</span>, <span class="va">df</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   (Intercept)  I(x + 1e+06) </span></span>
<span><span class="co">#&gt; -9.974923e+05  9.974923e-01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1e7</span><span class="op">)</span>, <span class="va">df</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept) I(x + 1e+07) </span></span>
<span><span class="co">#&gt;    0.500031           NA</span></span></code></pre></div>
<p>Contrary to <code>feols</code>, for a translation of 1,000,000
<code>lm</code> does not remove the variable and gives the right result.
However, the behavior becomes similar to that of <code>feols</code> when
we apply a translation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mn>7</mn></msup><annotation encoding="application/x-tex">10^7</annotation></semantics></math>.
A notable difference between the two routines is that there is no
explicit message from <code>lm</code> (but this is displayed in
<code>lm</code>’s <code>summary</code>).</p>
<p><strong>Bottom line.</strong> Collinearity detection and fixing is a
numerical problem and as such is subject to the ususal pitfall of these,
in particular precision problems. Always be wary when variables are
removed: if there is no theoretical reason for removal then there might
be a data problem. In general, ensuring that the variables have a
reasonable numerical range is a good idea. Do not hesitate to re-scale
the variables with a large range.</p>
</div>
<div class="section level3">
<h3 id="subsec_removal_good">When automatic removal is good<a class="anchor" aria-label="anchor" href="#subsec_removal_good"></a>
</h3>
<p>Consider the context defined in the <a href="#subsec_gender_gap">model misspecification section</a>: where we
follow the output of a panel of scientists. Here we want to see the
effect of age on performance, when removing individual-specific
confounders and confounders linked to the institution of the scientist.
Formally, we estimate the following model:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>α</mi><mi>i</mi></msub><mo>+</mo><msub><mi>β</mi><mi>j</mi></msub><mo>+</mo><mi>γ</mi><mi>a</mi><mi>g</mi><msub><mi>e</mi><mrow><mi>i</mi><mi>j</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>ϵ</mi><mrow><mi>i</mi><mi>j</mi><mi>t</mi></mrow></msub><mo>,</mo></mrow><annotation encoding="application/x-tex"> y_{ijt} = \alpha_i + \beta_j + \gamma age_{ijt} + \epsilon_{ijt}, </annotation></semantics></math></p>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
indexing the scientist,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
the institution and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
the year.</p>
<p>Our coefficient of interest is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>
and we include scientist and institution fixed-effects. For this example
we use a built-in data set of <code>fixest</code>: <code>base_pub</code>
which corresponds to a small panel following the output of researchers
across time (this panel is constructed from Microsoft Academic Graph
data). Although <code>feols</code> does have a specific way to handle
fixed-effects, for illustration we include the two fixed-effects as
dummies using the function <code><a href="../reference/i.html">i()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base_pub</span>, package <span class="op">=</span> <span class="st">"fixest"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The model:</span></span>
<span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">nb_pub</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">author_id</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">affil_id</span><span class="op">)</span>, <span class="va">base_pub</span><span class="op">)</span></span>
<span><span class="co">#&gt; The variables 'affil_id::6902469', 'affil_id::9217761', 'affil_id::27504731',</span></span>
<span><span class="co">#&gt; 'affil_id::39965400', 'affil_id::43522216', 'affil_id::47301684' and 45 others have been</span></span>
<span><span class="co">#&gt; removed because of collinearity (see $collin.var).</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: nb_pub</span></span>
<span><span class="co">#&gt; Observations: 4,024</span></span>
<span><span class="co">#&gt; Standard-errors: IID</span></span>
<span><span class="co">#&gt;                       Estimate Std. Error   t value   Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept)          -4.700489   2.396759 -1.961185 4.9934e-02 *</span></span>
<span><span class="co">#&gt; age                   0.047252   0.006213  7.605218 3.6032e-14 ***</span></span>
<span><span class="co">#&gt; author_id::90561406  -1.458487   0.902767 -1.615574 1.0627e-01</span></span>
<span><span class="co">#&gt; author_id::94862465  -3.390346   1.862776 -1.820050 6.8834e-02 .</span></span>
<span><span class="co">#&gt; author_id::168896994  0.473991   2.447235  0.193684 8.4643e-01</span></span>
<span><span class="co">#&gt; author_id::217986139 -0.133319   1.734549 -0.076861 9.3874e-01    </span></span>
<span><span class="co">#&gt; author_id::226108609  0.179560   2.021085  0.088843 9.2921e-01</span></span>
<span><span class="co">#&gt; author_id::231631639  2.799524   3.110143  0.900127 3.6811e-01</span></span>
<span><span class="co">#&gt; ... 397 coefficients remaining (display them with summary() or use argument n)</span></span>
<span><span class="co">#&gt; ... 51 variables were removed because of collinearity (affil_id::6902469,</span></span>
<span><span class="co">#&gt; affil_id::9217761 and 49 others [full set in $collin.var])</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 2.21108   Adj. R2: 0.685792</span></span></code></pre></div>
<p>As the output shows clearly, 51 variables have been removed to fix
collinearity. In this case, this is perfectly fine since our variable of
interest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">age</annotation></semantics></math>,
is not included in the collinear set. Many variables are removed because
there is a lot of overlap between the affiliations and the researchers:
many researchers have only a few different affiliations across their
career, and many affiliations just have one researcher (remember that we
deal with a small random sample here).</p>
<p>Note that the recommended way to include fixed-effects in
<code>feols</code> is by adding the fixed-effects variables after a
pipe. That way the FWL theorem is leveraged and all variables are first
residualized on the fixed-effects (see <a href="#subsec_FWL">the FWL
section</a>). By handling the fixed-effects specifically the output
becomes much clearer and you <em>are sure</em> that the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">age</annotation></semantics></math>
is not in the collinear set (see next section for why this is
important):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">nb_pub</span> <span class="op">~</span> <span class="va">age</span> <span class="op">|</span> <span class="va">author_id</span> <span class="op">+</span> <span class="va">affil_id</span>, <span class="va">base_pub</span>, vcov <span class="op">=</span> <span class="st">"iid"</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: nb_pub</span></span>
<span><span class="co">#&gt; Observations: 4,024</span></span>
<span><span class="co">#&gt; Fixed-effects: author_id: 200,  affil_id: 256</span></span>
<span><span class="co">#&gt; Standard-errors: IID</span></span>
<span><span class="co">#&gt;     Estimate Std. Error t value   Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; age 0.047252   0.006257 7.55144 5.4359e-14 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 2.21108     Adj. R2: 0.681301</span></span>
<span><span class="co">#&gt;                 Within R2: 0.015731</span></span></code></pre></div>
<p>Coming back to our first question: Why is automatic variable removal
a feature? In this example the scientist and affiliation fixed-effects
<em>are just controls</em> and the researcher has no interest in
interpreting them. Therefore collinearity is no issue here and it does
not matter which variable is removed to fix collinearity.</p>
<p>Automatic variable removal is a critical feature especially for
routines that do not handle fixed-effects specifically, like
<code>lm</code>. If there was no automatic variable removal in
<code>lm</code>, you would not be able to estimate your model even
though it <em>is</em> well specified!</p>
</div>
<div class="section level3">
<h3 id="when-automatic-removal-bites">When automatic removal bites<a class="anchor" aria-label="anchor" href="#when-automatic-removal-bites"></a>
</h3>
<p>Automatic variable removal can be a problem <strong>when your model
is misspecified</strong> and you haven’t noticed it.</p>
<p>We keep using the example on publications. Remember from the section
discussing misspecification that the following model is
misspecified:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>α</mi><mi>i</mi></msub><mo>+</mo><msub><mi>β</mi><mi>t</mi></msub><mo>+</mo><mi>γ</mi><mo>×</mo><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><msub><mi>n</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>+</mo><mi>θ</mi><mo>×</mo><mi>a</mi><mi>g</mi><msub><mi>e</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>ϵ</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><mo>,</mo></mrow><annotation encoding="application/x-tex"> y_{it} = \alpha_i + \beta_t + \gamma \times woman_{it} + \theta \times age_{it} + \epsilon_{it}, </annotation></semantics></math></p>
<p>as both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>o</mi><mi>m</mi><mi>a</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">woman</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">age</annotation></semantics></math>
are in the collinear set.</p>
<p>We estimate this model anyway by including the scientist and year
fixed-effects as dummy variables:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">nb_pub</span> <span class="op">~</span> <span class="va">is_woman</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">author_id</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">base_pub</span><span class="op">)</span></span>
<span><span class="co">#&gt; The variables 'author_id::2747123765' and 'year::2000' have been removed because of</span></span>
<span><span class="co">#&gt; collinearity (see $collin.var).</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: nb_pub</span></span>
<span><span class="co">#&gt; Observations: 4,024</span></span>
<span><span class="co">#&gt; Standard-errors: IID</span></span>
<span><span class="co">#&gt;                       Estimate Std. Error   t value Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept)           3.224328   2.203459  1.463303  0.14347</span></span>
<span><span class="co">#&gt; is_woman             -0.673406   1.624295 -0.414583  0.67847</span></span>
<span><span class="co">#&gt; age                   0.046843   0.045423  1.031271  0.30248</span></span>
<span><span class="co">#&gt; author_id::90561406  -1.028373   1.093804 -0.940180  0.34719</span></span>
<span><span class="co">#&gt; author_id::94862465  -1.953734   0.985021 -1.983444  0.04739 *</span></span>
<span><span class="co">#&gt; author_id::168896994 -1.449938   0.914733 -1.585094  0.11303</span></span>
<span><span class="co">#&gt; author_id::217986139 -1.576761   0.923925 -1.706591  0.08798 .</span></span>
<span><span class="co">#&gt; author_id::226108609 -0.568410   1.171480 -0.485207  0.62756</span></span>
<span><span class="co">#&gt; ... 242 coefficients remaining (display them with summary() or use argument n)</span></span>
<span><span class="co">#&gt; ... 2 variables were removed because of collinearity (author_id::2747123765 and</span></span>
<span><span class="co">#&gt; year::2000)</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 2.96683   Adj. R2: 0.457524</span></span></code></pre></div>
<p>It just worked! We have coefficients for <code>is_woman</code> and
<code>age</code>! Good news right, we thought our model was misspecified
but in fact it’s not: we can estimate the gender gap with fixed-effects!
Or is it?</p>
<p>Well of course this is just a dream. If the model is misspecified in
theory, it remains misspecified in practice: the estimates for
<code>is_woman</code> and <code>age</code> do exist but cannot be
intrepreted. To better see why let’s replicate the previous estimation
where we cosmetically modify the fixed-effects:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># same estimation as above</span></span>
<span><span class="va">est_num</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">nb_pub</span> <span class="op">~</span> <span class="va">is_woman</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">author_id</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">base_pub</span><span class="op">)</span></span>
<span><span class="co">#&gt; The variables 'author_id::2747123765' and 'year::2000' have been removed because of</span></span>
<span><span class="co">#&gt; collinearity (see $collin.var).</span></span>
<span></span>
<span><span class="co"># we create `author_id_char`: same as `author_id` but in character form</span></span>
<span><span class="va">base_pub</span><span class="op">$</span><span class="va">author_id_char</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">base_pub</span><span class="op">$</span><span class="va">author_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># replacing `author_id` with `author_id_char`: both variables contain the same information</span></span>
<span><span class="va">est_char</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">nb_pub</span> <span class="op">~</span> <span class="va">is_woman</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">author_id_char</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">base_pub</span><span class="op">)</span></span>
<span><span class="co">#&gt; The variables 'author_id_char::731914895' and 'year::2000' have been removed because of</span></span>
<span><span class="co">#&gt; collinearity (see $collin.var).</span></span>
<span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">est_num</span>, <span class="va">est_char</span>, keep <span class="op">=</span> <span class="st">"woman|age"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         est_num        est_char</span></span>
<span><span class="co">#&gt; Dependent Var.:          nb_pub          nb_pub</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; is_woman        -0.6734 (1.624)   1.729 (3.174)</span></span>
<span><span class="co">#&gt; age             0.0468 (0.0454) 0.0468 (0.0454)</span></span>
<span><span class="co">#&gt; _______________ _______________ _______________</span></span>
<span><span class="co">#&gt; S.E. type                   IID             IID</span></span>
<span><span class="co">#&gt; Observations              4,024           4,024</span></span>
<span><span class="co">#&gt; R2                      0.49110         0.49110</span></span>
<span><span class="co">#&gt; Adj. R2                 0.45752         0.45752</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>We can see that although the two estimations are identical in
principle, the coefficient associated to the variable
<code>is_woman</code> varies widely. But the results should not depend
on whether you store a categorical variable in character or numeric
form!</p>
<p>The difference is due to the fact that the algorithm removes the
variables using the order given by the user. Storing the variable
<code>author_id</code> in numeric or charcter form leads to different
ordering of the categorical values, and hence a different variable is
removed.</p>
<p><strong>Shouldn’t there be an error from the software?</strong> As
seen in the <a href="#subsec_removal_good">previous section</a>,
automatic removal of collinear variables <em>is useful</em>. The
fundemental problem is that the routines: i) can’t compute the collinear
sets (this is very costly), and ii) don’t know which variables are the
ones of interest. Hence it assumes that the user is knowledgeable and
provides a well specified model, for which collinearity is not a
problem.</p>
<p>What can the user do? Here’s a trick. To check whether your variables
of interest are in a collinear set, simply place them last:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_last</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">nb_pub</span> <span class="op">~</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">author_id</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="va">is_woman</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">base_pub</span><span class="op">)</span></span>
<span><span class="co">#&gt; The variables 'is_woman' and 'age' have been removed because of collinearity (see</span></span>
<span><span class="co">#&gt; $collin.var).</span></span></code></pre></div>
<p>Now the two variables of interest are out! The sign of model
misspecification couldn’t be clearer!</p>
<p>If you use routines that handle fixed-effects specifically, like
<code>feols</code>, try to treat all your categorical variables as
fixed-effects. This way you have the garantee that the variables of
interest are not in the same collinear set as the fixed-effects. Here is
the same example with explicit fixed-effects:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">nb_pub</span> <span class="op">~</span> <span class="va">is_woman</span> <span class="op">+</span> <span class="va">age</span> <span class="op">|</span> <span class="va">author_id</span> <span class="op">+</span> <span class="va">year</span>, <span class="va">base_pub</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: in feols(nb_pub ~ is_woman + age | author_id + year,...:</span></span>
<span><span class="co">#&gt; All variables, 'is_woman' and 'age', are collinear with the fixed effects. Without</span></span>
<span><span class="co">#&gt; doubt, your model is misspecified.</span></span></code></pre></div>
<p>The routine detects that the variables ‘is_woman’ and ‘age’ are
collinear with the fixed-effects, and removes them from the estimation.
Since there is no more variable, the estimation makes no sense and you
have a suggestion that your model may be misspecified.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
