<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Centers a set of variables around a set of factors — demean • fixest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Centers a set of variables around a set of factors — demean"><meta name="description" content="User-level access to internal demeaning algorithm of fixest."><meta property="og:description" content="User-level access to internal demeaning algorithm of fixest."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fixest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.12.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_estimations.html">Multiple estimations</a></li>
    <li><a class="dropdown-item" href="../articles/standard_errors.html">On standard-errors</a></li>
    <li><a class="dropdown-item" href="../articles/collinearity.html">On collinearity</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Estimation tables</h6></li>
    <li><a class="dropdown-item" href="../articles/exporting_tables.html">Exporting estimation tables</a></li>
    <li><a class="dropdown-item" href="../articles/etable_new_features.html">`etable`: new features in `fixest` 0.10.2</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lrberge/fixest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Centers a set of variables around a set of factors</h1>
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/HEAD/R/miscfuns.R" class="external-link"><code>R/miscfuns.R</code></a></small>
      <div class="d-none name"><code>demean.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>User-level access to internal demeaning algorithm of <code>fixest</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">demean</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">f</span>,</span>
<span>  <span class="va">slope.vars</span>,</span>
<span>  <span class="va">slope.flag</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  nthreads <span class="op">=</span> <span class="fu"><a href="setFixest_nthreads.html">getFixest_nthreads</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  notes <span class="op">=</span> <span class="fu"><a href="setFixest_notes.html">getFixest_notes</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  fixef.reorder <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fixef.algo <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  as.matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/is.recursive.html" class="external-link">is.atomic</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>,</span>
<span>  im_confident <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A matrix, vector, data.frame or a list OR a formula OR a <code><a href="feols.html">feols</a></code> estimation. If equal
to a formula, then the argument <code>data</code> is required, and it must be of the type:
<code>x1 + x2 ~ f1 + fe2</code> with on the LHS the variables to be centered, and on the RHS the factors
used for centering. Note that you can use variables with varying slopes with the syntax
<code>fe[v1, v2]</code> (see details in <code><a href="feols.html">feols</a></code>). If a <code>feols</code> estimation, all variables (LHS+RHS) are
demeaned and then returned (only if it was estimated with fixed-effects). Otherwise, it must
represent the data to be centered. Of course the number of observations of that data must be the
same as the factors used for centering (argument <code>f</code>).</p></dd>


<dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>A matrix, vector, data.frame or list. The factors used to center the variables in
argument <code>X</code>. Matrices will be coerced using <code>as.data.frame</code>.</p></dd>


<dt id="arg-slope-vars">slope.vars<a class="anchor" aria-label="anchor" href="#arg-slope-vars"></a></dt>
<dd><p>A vector, matrix or list representing the variables with varying slopes.
Matrices will be coerced using <code>as.data.frame</code>. Note that if this argument is used it MUST be in
conjunction with the argument <code>slope.flag</code> that maps the factors to which the varying slopes are
attached. See examples.</p></dd>


<dt id="arg-slope-flag">slope.flag<a class="anchor" aria-label="anchor" href="#arg-slope-flag"></a></dt>
<dd><p>An integer vector of the same length as the number of variables in <code>f</code> (the
factors used for centering). It indicates for each factor the number of variables with varying
slopes to which it is associated. Positive values mean that the raw factor should also be
included in the centering, negative values that it should be excluded. Sorry it's complicated...
but see the examples it may get clearer.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data.frame containing all variables in the argument <code>X</code>. Only used if <code>X</code> is a
formula, in which case <code>data</code> is mandatory.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Vector, can be missing or NULL. If present, it must contain the same number of
observations as in <code>X</code>.</p></dd>


<dt id="arg-nthreads">nthreads<a class="anchor" aria-label="anchor" href="#arg-nthreads"></a></dt>
<dd><p>Number of threads to be used. By default it is equal to <code><a href="setFixest_nthreads.html">getFixest_nthreads()</a></code>.</p></dd>


<dt id="arg-notes">notes<a class="anchor" aria-label="anchor" href="#arg-notes"></a></dt>
<dd><p>Logical, whether to display a message when NA values are removed. By default it is
equal to <code><a href="setFixest_notes.html">getFixest_notes()</a></code>.</p></dd>


<dt id="arg-iter">iter<a class="anchor" aria-label="anchor" href="#arg-iter"></a></dt>
<dd><p>Number of iterations, default is 2000.</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>Stopping criterion of the algorithm. Default is <code>1e-6</code>. The algorithm stops when the
maximum absolute increase in the coefficients values is lower than <code>tol</code>.</p></dd>


<dt id="arg-fixef-reorder">fixef.reorder<a class="anchor" aria-label="anchor" href="#arg-fixef-reorder"></a></dt>
<dd><p>Logical, default is <code>TRUE</code>. Whether to reorder the fixed-effects by
frequencies before feeding them into the algorithm. If <code>FALSE</code>, the original fixed-effects order
provided by the user is maintained. In general, reordering leads to faster and more precise
performance.</p></dd>


<dt id="arg-fixef-algo">fixef.algo<a class="anchor" aria-label="anchor" href="#arg-fixef-algo"></a></dt>
<dd><p><code>NULL</code> (default) or an object of class <code>demeaning_algo</code> obtained with
the function <code><a href="demeaning_algo.html">demeaning_algo</a></code>. If <code>NULL</code>, it falls to the defaults of <code><a href="demeaning_algo.html">demeaning_algo</a></code>.
This arguments controls the settings of the demeaning algorithm.
Only play with it if the convergence is slow, i.e. look at the slot <code>$iterations</code>, and if any is
over 50, it may be worth playing around with it. Please read the documentation of the
function <code><a href="demeaning_algo.html">demeaning_algo</a></code>. Be aware that there is no clear guidance on how to change the
settings, it's more a matter of try-and-see.</p></dd>


<dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Logical, default is <code>TRUE</code>. If <code>TRUE</code> and the input data contains any NA value,
then any observation with NA will be discarded leading to an output with less observations than
the input. If <code>FALSE</code>, if NAs are present the output will also be filled with NAs for each NA
observation in input.</p></dd>


<dt id="arg-as-matrix">as.matrix<a class="anchor" aria-label="anchor" href="#arg-as-matrix"></a></dt>
<dd><p>Logical, if <code>TRUE</code> a matrix is returned, if <code>FALSE</code> it will be a data.frame.
The default depends on the input, if atomic then a matrix will be returned.</p></dd>


<dt id="arg-im-confident">im_confident<a class="anchor" aria-label="anchor" href="#arg-im-confident"></a></dt>
<dd><p>Logical, default is <code>FALSE</code>. FOR EXPERT USERS ONLY! This argument allows to
skip some of the preprocessing of the arguments given in input. If <code>TRUE</code>, then <code>X</code> MUST be a
numeric vector/matrix/list (not a formula!), <code>f</code> MUST be a list, <code>slope.vars</code> MUST be a list,
<code>slope.vars</code> MUST be consistent with <code>slope.flag</code>, and <code>weights</code>, if given, MUST be numeric (not
integer!). Further there MUST be not any NA value, and the number of observations of each
element MUST be consistent. Non compliance to these rules may simply lead your R session to
break.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Not currently used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>It returns a data.frame of the same number of columns as the number of variables to be centered.</p>
<p>If <code>na.rm = TRUE</code>, then the number of rows is equal to the number of rows in input minus the
number of NA values (contained in <code>X</code>, <code>f</code>, <code>slope.vars</code> or <code>weights</code>). The default is to have
an output of the same number of observations as the input (filled with NAs where appropriate).</p>
<p>A matrix can be returned if <code>as.matrix = TRUE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="varying-slopes">Varying slopes<a class="anchor" aria-label="anchor" href="#varying-slopes"></a></h2>


<p>You can add variables with varying slopes in the fixed-effect part of the formula.
The syntax is as follows: <code>fixef_var[var1, var2]</code>. Here the variables var1 and var2 will
be with varying slopes (one slope per value in fixef_var) and the fixed-effect
fixef_var will also be added.</p>
<p>To add only the variables with varying slopes and not the fixed-effect,
use double square brackets: <code>fixef_var[[var1, var2]]</code>.</p>
<p>In other words:</p><ul><li><p><code>fixef_var[var1, var2]</code> is equivalent to <code>fixef_var + fixef_var[[var1]] + fixef_var[[var2]]</code></p></li>
<li><p><code>fixef_var[[var1, var2]]</code> is equivalent to <code>fixef_var[[var1]] + fixef_var[[var2]]</code></p></li>
</ul><p>In general, for convergence reasons, it is recommended to always add the fixed-effect and
avoid using only the variable with varying slope (i.e. use single square brackets).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Illustration of the FWL theorem</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">base</span> <span class="op">=</span> <span class="va">trade</span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">ln_dist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">base</span><span class="op">$</span><span class="va">dist_km</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">ln_euros</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">base</span><span class="op">$</span><span class="va">Euros</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We center the two variables ln_dist and ln_euros</span></span></span>
<span class="r-in"><span><span class="co">#  on the factors Origin and Destination</span></span></span>
<span class="r-in"><span><span class="va">X_demean</span> <span class="op">=</span> <span class="fu">demean</span><span class="op">(</span>X <span class="op">=</span> <span class="va">base</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ln_dist"</span>, <span class="st">"ln_euros"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                  f <span class="op">=</span> <span class="va">base</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Origin"</span>, <span class="st">"Destination"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ln_dist_dm"</span>, <span class="st">"ln_euros_dm"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">X_demean</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">ln_euros_dm</span> <span class="op">~</span> <span class="va">ln_dist_dm</span>, <span class="va">base</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">est_fe</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">ln_euros</span> <span class="op">~</span> <span class="va">ln_dist</span> <span class="op">|</span> <span class="va">Origin</span> <span class="op">+</span> <span class="va">Destination</span>, <span class="va">base</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The results are the same as if we used the two factors</span></span></span>
<span class="r-in"><span><span class="co"># as fixed-effects</span></span></span>
<span class="r-in"><span><span class="fu"><a href="etable.html">etable</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">est_fe</span>, se <span class="op">=</span> <span class="st">"st"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                est             est_fe</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependent Var.:        ln_euros_dm           ln_euros</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Constant        -6.89e-14 (0.0116)                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ln_dist_dm      -2.072*** (0.0271)                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ln_dist                            -2.072*** (0.0271)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed-Effects:  ------------------ ------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Origin                          No                Yes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Destination                     No                Yes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _______________ __________________ __________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> S.E. type                      IID                IID</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations                38,325             38,325</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R2                         0.13218            0.50428</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Within R2                       --            0.13218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Variables with varying slopes</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can center on factors but also on variables with varying slopes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's have an illustration</span></span></span>
<span class="r-in"><span><span class="va">base</span> <span class="op">=</span> <span class="va">iris</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"species"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># We center y and x1 on species and x2 * species</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using a formula</span></span></span>
<span class="r-in"><span><span class="va">base_dm</span> <span class="op">=</span> <span class="fu">demean</span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">~</span> <span class="va">species</span><span class="op">[</span><span class="va">x2</span><span class="op">]</span>, data <span class="op">=</span> <span class="va">base</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using vectors</span></span></span>
<span class="r-in"><span><span class="va">base_dm_bis</span> <span class="op">=</span> <span class="fu">demean</span><span class="op">(</span>X <span class="op">=</span> <span class="va">base</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x1"</span><span class="op">)</span><span class="op">]</span>, f <span class="op">=</span> <span class="va">base</span><span class="op">$</span><span class="va">species</span>,</span></span>
<span class="r-in"><span>                     slope.vars <span class="op">=</span> <span class="va">base</span><span class="op">$</span><span class="va">x2</span>, slope.flag <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's look at the equivalences</span></span></span>
<span class="r-in"><span><span class="va">res_vs_1</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">species</span> <span class="op">+</span> <span class="va">x2</span><span class="op">:</span><span class="va">species</span>, <span class="va">base</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_vs_2</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, <span class="va">base_dm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_vs_3</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, <span class="va">base_dm_bis</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># only the small sample adj. differ in the SEs</span></span></span>
<span class="r-in"><span><span class="fu"><a href="etable.html">etable</a></span><span class="op">(</span><span class="va">res_vs_1</span>, <span class="va">res_vs_2</span>, <span class="va">res_vs_3</span>, keep <span class="op">=</span> <span class="st">"x1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           res_vs_1           res_vs_2           res_vs_3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependent Var.:                  y                  y                  y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1              0.4500*** (0.0806) 0.4500*** (0.0792) 0.4500*** (0.0792)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _______________ __________________ __________________ __________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> S.E. type                      IID                IID                IID</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations                   150                150                150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R2                         0.86900            0.17894            0.17894</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adj. R2                    0.86351            0.17340            0.17340</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># center on x2 * species and on another FE</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">fe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using a formula =&gt; double square brackets!</span></span></span>
<span class="r-in"><span><span class="va">base_dm</span> <span class="op">=</span> <span class="fu">demean</span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">~</span> <span class="va">fe</span> <span class="op">+</span> <span class="va">species</span><span class="op">[[</span><span class="va">x2</span><span class="op">]</span><span class="op">]</span>, data <span class="op">=</span> <span class="va">base</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using vectors =&gt; note slope.flag!</span></span></span>
<span class="r-in"><span><span class="va">base_dm_bis</span> <span class="op">=</span> <span class="fu">demean</span><span class="op">(</span>X <span class="op">=</span> <span class="va">base</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x1"</span><span class="op">)</span><span class="op">]</span>, f <span class="op">=</span> <span class="va">base</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fe"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                     slope.vars <span class="op">=</span> <span class="va">base</span><span class="op">$</span><span class="va">x2</span>, slope.flag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Explanations slope.flag = c(0, -1):</span></span></span>
<span class="r-in"><span><span class="co"># - the first 0: the first factor (fe) is associated to no variable</span></span></span>
<span class="r-in"><span><span class="co"># - the "-1":</span></span></span>
<span class="r-in"><span><span class="co">#    * |-1| = 1: the second factor (species) is associated to ONE variable</span></span></span>
<span class="r-in"><span><span class="co">#    *   -1 &lt; 0: the second factor should not be included as such</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's look at the equivalences</span></span></span>
<span class="r-in"><span><span class="va">res_vs_1</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="i.html">i</a></span><span class="op">(</span><span class="va">fe</span><span class="op">)</span> <span class="op">+</span> <span class="va">x2</span><span class="op">:</span><span class="va">species</span>, <span class="va">base</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_vs_2</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, <span class="va">base_dm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_vs_3</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, <span class="va">base_dm_bis</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># only the small sample adj. differ in the SEs</span></span></span>
<span class="r-in"><span><span class="fu"><a href="etable.html">etable</a></span><span class="op">(</span><span class="va">res_vs_1</span>, <span class="va">res_vs_2</span>, <span class="va">res_vs_3</span>, keep <span class="op">=</span> <span class="st">"x1"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           res_vs_1           res_vs_2           res_vs_3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependent Var.:                  y                  y                  y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1              0.4915*** (0.0839) 0.4915*** (0.0819) 0.4915*** (0.0819)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _______________ __________________ __________________ __________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> S.E. type                      IID                IID                IID</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations                   150                150                150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R2                         0.85514            0.19580            0.19580</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adj. R2                    0.84693            0.19037            0.19037</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

