<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Controls the parameters of the demeaning procedure — demeaning_algo • fixest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Controls the parameters of the demeaning procedure — demeaning_algo"><meta name="description" content="Fine control of the demeaning procedure. Since the defaults are sensible,
only use this function in case of difficult convergence (e.g. in feols or demean).
That is, look at the slot $iterations of the returned object, if it's high (over 50),
then it might be worth playing around with these settings."><meta property="og:description" content="Fine control of the demeaning procedure. Since the defaults are sensible,
only use this function in case of difficult convergence (e.g. in feols or demean).
That is, look at the slot $iterations of the returned object, if it's high (over 50),
then it might be worth playing around with these settings."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fixest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.12.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_estimations.html">Multiple estimations</a></li>
    <li><a class="dropdown-item" href="../articles/standard_errors.html">On standard-errors</a></li>
    <li><a class="dropdown-item" href="../articles/collinearity.html">On collinearity</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Estimation tables</h6></li>
    <li><a class="dropdown-item" href="../articles/exporting_tables.html">Exporting estimation tables</a></li>
    <li><a class="dropdown-item" href="../articles/etable_new_features.html">`etable`: new features in `fixest` 0.10.2</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lrberge/fixest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Controls the parameters of the demeaning procedure</h1>
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/HEAD/R/miscfuns.R" class="external-link"><code>R/miscfuns.R</code></a></small>
      <div class="d-none name"><code>demeaning_algo.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fine control of the demeaning procedure. Since the defaults are sensible,
only use this function in case of difficult convergence (e.g. in <code><a href="feols.html">feols</a></code> or <code><a href="demean.html">demean</a></code>).
That is, look at the slot <code>$iterations</code> of the returned object, if it's high (over 50),
then it might be worth playing around with these settings.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">demeaning_algo</span><span class="op">(</span></span>
<span>  extraProj <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  iter_warmup <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  iter_projAfterAcc <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  iter_grandAcc <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  internal <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-extraproj">extraProj<a class="anchor" aria-label="anchor" href="#arg-extraproj"></a></dt>
<dd><p>Integer scalar, default is 0. Should there be more plain projection steps
in between two accelerations? By default there is not. Each integer value adds 3
simple projections.
This can be useful in cases where the acceleration algorithm does not work well
but simple projections do.</p></dd>


<dt id="arg-iter-warmup">iter_warmup<a class="anchor" aria-label="anchor" href="#arg-iter-warmup"></a></dt>
<dd><p>Integer scalar, default is 15. Only used in the presence of 3
or more fixed-effects (FE), ignored otherwise. For 3+ FEs, the algorithm is as follows:</p><ol><li><p><code>iter_warmup</code> iterations on all FEs. If convergence: end of the algorithm. 2) Otherwise:
a) demeaning over the first two largest FEs only, until convergence, then
b) demeaning over all FEs until convergence.
To skip the demeaning over 2 FEs, use a very high value of <code>iter_warmup</code>. To go directly
to the demeaning over 2 FEs, se <code>iter_warmup</code> to a value lower than or equal to 0.</p></li>
</ol></dd>


<dt id="arg-iter-projafteracc">iter_projAfterAcc<a class="anchor" aria-label="anchor" href="#arg-iter-projafteracc"></a></dt>
<dd><p>Integer scalar, default is 40. After <code>iter_projAfterAcc</code> iterations
of the standard algorithm, a simple projection is performed right after
the acceleration step. Use very high values to skip this step, or low values to apply this
procedure right from the start.</p></dd>


<dt id="arg-iter-grandacc">iter_grandAcc<a class="anchor" aria-label="anchor" href="#arg-iter-grandacc"></a></dt>
<dd><p>Integer scalar, default is 4. The regular fixed-point algorithm
applies an acceleration at each iteration. This acceleration is for <code>f(X)</code>
(with <code>f</code> the projection).
This settings controls a grand acceleration, which is instead for <code>f^k(X)</code> where
<code>k</code> is the value of <code>iter_grandAcc</code> and <code>f^2(X)</code> is defined as <code>f(f(X))</code>
(i.e. the function <code>f</code> applied <code>k</code> times). By default, an additional acceleration
is performed for <code>h(X) = f^4(X)</code> every 8 iterations (2 times 4, equivalent to
the iterationsthe time to gather <code>h(X)</code> and <code>h(h(X))</code>).</p></dd>


<dt id="arg-internal">internal<a class="anchor" aria-label="anchor" href="#arg-internal"></a></dt>
<dd><p>Logical scalar, default is <code>FALSE</code>. If <code>TRUE</code>, no check on the arguments
is performed and the returned object is a plain list. For internal use only.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>This function returns a list of 4 integers, equal to the arguments passed by the user.
That list is of class <code>demeaning_algo</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The demeaning algorithm is a fixed-point algorithm. Basically a function <code>f</code> is applied
until <code>|f(X) - X| = 0</code>, i.e. there is no difference between <code>X</code> and its image.
For terminology, let's call the application of <code>f</code> a "projection".</p>
<p>For well behaved problems, the algorithm in its simplest form, i.e. just applying <code>f</code> until
convergence, works fine and you only need a few iterations to reach convergence.</p>
<p>The problems arise for non well behaved problems. In these cases, simply applying the
function <code>f</code> can lead to extremely slow convergence. To handle these cases, this algorithm
applies a fixed-point acceleration algorithm, namely the "Irons and Tuck" acceleration.</p>
<p>The main algorithm combines regular projections with accelerations. Unfortunately
sometimes this is not enough, so we also resort on internal cuisine, detailed below.</p>
<p>Sometimes the acceleration in its simplest form does not work well, and garbles the
convergence properties. In those cases:</p><ul><li><p>the argument <code>extraProj</code> adds several standard projections in between two accelerations,
which can improve the performance of the algorithm. By default there are no extra
projections. Note that while it can reduce the total number of iterations until convergence,
each iterations is almost twice expensive in terms of computing time.</p></li>
<li><p>the argument <code>iter_projAfterAcc</code> controls whether, and when, to apply a simple projection
right after the acceleration step. This projection adds roughly a 33% increase in
computing time per iteration but can improve the convergence properties and speed. By default
this step starts at iteration 40 (when the convergence rate is already not great).</p></li>
</ul><p>On top of this, in case of very difficult convergence, a "grand" acceleration is added to
the algorithm. The regular acceleration is over <code>f</code>. Say <code>g</code> is the function equivalent to
the application of one regular iteration (which is a combination of one acceleration with
several projections).
By default the grand acceleration is over <code>h = g o g o g o g</code>, otherwise <code>g</code> applied four times.
The grand acceleration is controled with the argument <code>iter_grandAcc</code> which corresponds
to the number of iterations of the regular algorithm defining <code>h</code>.</p>
<p>Finally in case of 3+ fixed-effects (FE), the convergence in general takes more iterations.
In cases of the absence of quick convergence, applying a first demeaning over the first
two largest FEs before applying the demeaning over all FEs can improve convergence speed.
This is controlled with the argument <code>iter_warmup</code> which gives the number of iterations
over all the FEs to run before going to the 2 FEs demeaning. By default, the deameaning
over all FEs is run for 15 iterations before switching to the 2 FEs case.</p>
<p>The above defaults are the outcome of extended empirical applications, and try to strike a
balance across a majority of cases. Of course you can always get better results by tailoring
the settings to your problem at hand.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>B. M. Irons, R. Tuck, "A version of the Aitken accelerator for computer iteration",
International journal of numerical methods in engineering 1 (1969) 670 275–277.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

