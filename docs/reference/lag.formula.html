<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Lags a variable using a formula — lag.formula • fixest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Lags a variable using a formula — lag.formula"><meta name="description" content="Lags a variable using panel id + time identifiers in a formula."><meta property="og:description" content="Lags a variable using panel id + time identifiers in a formula."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fixest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.12.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_estimations.html">Multiple estimations</a></li>
    <li><a class="dropdown-item" href="../articles/standard_errors.html">On standard-errors</a></li>
    <li><a class="dropdown-item" href="../articles/collinearity.html">On collinearity</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Estimation tables</h6></li>
    <li><a class="dropdown-item" href="../articles/exporting_tables.html">Exporting estimation tables</a></li>
    <li><a class="dropdown-item" href="../articles/etable_new_features.html">`etable`: new features in `fixest` 0.10.2</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lrberge/fixest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Lags a variable using a formula</h1>
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/HEAD/R/panel.R" class="external-link"><code>R/panel.R</code></a></small>
      <div class="d-none name"><code>lag.formula.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Lags a variable using panel id + time identifiers in a formula.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  time.step <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fill <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  duplicate.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"first"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lag_fml</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  time.step <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fill <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  duplicate.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"first"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A formula of the type <code>var ~ id + time</code> where <code>var</code> is the variable to be lagged,
<code>id</code> is a variable representing the panel id, and <code>time</code> is the time variable of the panel.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>An integer giving the number of lags. Default is 1. For leads,
just use a negative number.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Optional, the data.frame in which to evaluate the formula. If not provided,
variables will be fetched in the current environment.</p></dd>


<dt id="arg-time-step">time.step<a class="anchor" aria-label="anchor" href="#arg-time-step"></a></dt>
<dd><p>The method to compute the lags, default is <code>NULL</code> (which means
automatically set). Can be equal to: <code>"unitary"</code>, <code>"consecutive"</code>, <code>"within.consecutive"</code>,
or to a number. If <code>"unitary"</code>, then the largest common divisor between consecutive
time periods is used (typically if the time variable represents years, it will be 1).
This method can apply only to integer (or convertible to integer) variables.
If <code>"consecutive"</code>, then the time variable can be of any type: two successive
time periods represent a lag of 1. If <code>"witihn.consecutive"</code> then <strong>within a given id</strong>,
two successive time periods represent a lag of 1. Finally, if the time variable is numeric,
you can provide your own numeric time step.</p></dd>


<dt id="arg-fill">fill<a class="anchor" aria-label="anchor" href="#arg-fill"></a></dt>
<dd><p>Scalar. How to fill the observations without defined lead/lag values.
Default is <code>NA</code>.</p></dd>


<dt id="arg-duplicate-method">duplicate.method<a class="anchor" aria-label="anchor" href="#arg-duplicate-method"></a></dt>
<dd><p>If several observations have the same id and time values,
then the notion of lag is not defined for them. If <code>duplicate.method = "none"</code> (default)
and duplicate values are found, this leads to an error. You can use
<code>duplicate.method = "first"</code> so that the first occurrence of identical id/time
observations will be used as lag.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Not currently used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>It returns a vector of the same type and length as the variable to be lagged in the formula.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>

<ul><li><p><code>lag_fml()</code>: Lags a variable using a formula syntax</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Alternatively, the function <code><a href="panel.html">panel</a></code> changes a <code>data.frame</code> into a panel from which
the functions <code>l</code> and <code>f</code> (creating leads and lags) can be called. Otherwise you can set
the panel 'live' during the estimation using the argument <code>panel.id</code> (see for example in
the function <code><a href="feols.html">feols</a></code>).</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Laurent Berge</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># simple example with an unbalanced panel</span></span></span>
<span class="r-in"><span><span class="va">base</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">lag1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>,  <span class="fl">1</span>, <span class="va">base</span><span class="op">)</span> <span class="co"># lag 1</span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">lead1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="op">-</span><span class="fl">1</span>, <span class="va">base</span><span class="op">)</span> <span class="co"># lead 1</span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">lag2_fill0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="fl">2</span>, <span class="va">base</span>, fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># with time.step = "consecutive"</span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">lag1_consecutive</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="fl">1</span>, <span class="va">base</span>, time.step <span class="op">=</span> <span class="st">"consecutive"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#   =&gt; works for indiv. 2 because 9 (resp. 6) is consecutive to 6 (resp. 4)</span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">lag1_within.consecutive</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="fl">1</span>, <span class="va">base</span>, time.step <span class="op">=</span> <span class="st">"within"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#   =&gt; now two consecutive years within each indiv is one lag</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id time x lag1 lead1 lag2_fill0 lag1_consecutive lag1_within.consecutive</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1    1 1   NA     2          0               NA                      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  1    2 2    1     3          0                1                       1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  1    3 3    2     4          1                2                       2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  1    4 4    3    NA          2                3                       3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  2    1 5   NA    NA          0               NA                      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  2    4 6   NA    NA          0               NA                       5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  2    6 7   NA    NA          6                6                       6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  2    9 8   NA    NA          0                7                       7</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Argument time.step = "consecutive" is</span></span></span>
<span class="r-in"><span><span class="co"># mostly useful when the time variable is not a number:</span></span></span>
<span class="r-in"><span><span class="co"># e.g. c("1991q1", "1991q2", "1991q3") etc</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># with duplicates</span></span></span>
<span class="r-in"><span><span class="va">base_dup</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Error because of duplicate values for (id, time)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="fl">1</span>, <span class="va">base_dup</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in lag.formula(x ~ id + time, 1, base_dup): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The panel identifiers contain duplicate values: this is not allowed since</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lag/leads are not defined for them. For example (id, time) = (1, 1) appears</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> three times. Please provide data without duplicates -- or you can also use</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> duplicate.method = 'first' (see Details).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Error is bypassed, lag corresponds to first occurence of (id, time)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="fl">1</span>, <span class="va">base_dup</span>, duplicate.method <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA NA NA  1 NA  5  5  6</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Playing with time steps</span></span></span>
<span class="r-in"><span><span class="va">base</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># time step: 0.5 (here equivalent to lag of 1)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="fl">2</span>, <span class="va">base</span>, time.step <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA  1  2  3 NA NA NA NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Error: wrong time step</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="fl">2</span>, <span class="va">base</span>, time.step <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in lag.formula(x ~ id + time, 2, base, time.step = 7): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> If 'time.step' is a number, then it must be an exact divisor of all the</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> difference between two consecutive time periods. This is currently not the</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> case: 7 is not a divisor of 1 (the difference btw the time periods 2 and 1).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Adding NAs + unsorted IDs</span></span></span>
<span class="r-in"><span><span class="va">base</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="cn">NA</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">lag1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="fl">1</span>, <span class="va">base</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">base</span><span class="op">$</span><span class="va">lag1_within</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">time</span>, <span class="fl">1</span>, <span class="va">base</span>, time.step <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">base_bis</span> <span class="op">=</span> <span class="va">base</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">base</span><span class="op">$</span><span class="va">id</span>, <span class="va">base</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">base_bis</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id time x lag1 lag1_within</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  1    1 4   NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  1    3 3   NA           4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1    4 1    3           3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  1   NA 2   NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  2    1 7   NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  2    2 5    7           7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  2    3 8    5           5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  2   NA 6   NA          NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can create variables without specifying the data within data.table:</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">base</span> <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, year <span class="op">=</span> <span class="fl">1990</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">base</span><span class="op">[</span>, <span class="va">x.l1</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">year</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       id  year     x  x.l1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;int&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:     1  1991     1    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:     1  1992     2     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:     1  1993     3     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:     2  1991     4    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:     2  1992     5     4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:     2  1993     6     5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

